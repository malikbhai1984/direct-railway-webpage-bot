


import React, { useState, useEffect } from 'react';

export default function FootballPredictionSystem() {
  const [matches, setMatches] = useState([]);
  const [predictions, setPredictions] = useState([]);
  const [pktTime, setPktTime] = useState('');
  const [lastUpdate, setLastUpdate] = useState('--:--:--');
  const [loading, setLoading] = useState(true);

  // Update Pakistan Time
  useEffect(() => {
    const updateTime = () => {
      const now = new Date();
      const time = now.toLocaleString('en-PK', {
        timeZone: 'Asia/Karachi',
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
      });
      setPktTime(time);
      
      const updateTime = now.toLocaleTimeString('en-GB', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      setLastUpdate(updateTime);
    };
    
    updateTime();
    const interval = setInterval(updateTime, 1000);
    return () => clearInterval(interval);
  }, []);

  // Fetch data from backend
  useEffect(() => {
    const fetchData = async () => {
      try {
        const [matchesRes, predictionsRes] = await Promise.all([
          fetch('http://localhost:8080/api/matches'),
          fetch('http://localhost:8080/api/predictions')
        ]);

        const matchesData = await matchesRes.json();
        const predictionsData = await predictionsRes.json();

        if (matchesData.success) {
          setMatches(matchesData.data || []);
        }
        
        if (predictionsData.success) {
          setPredictions(predictionsData.data || []);
        }

        setLoading(false);
      } catch (error) {
        console.error('Fetch error:', error);
        setLoading(false);
      }
    };

    fetchData();
    const interval = setInterval(fetchData, 5 * 60 * 1000); // 5 minutes
    return () => clearInterval(interval);
  }, []);

  const getStatusBadge = (status) => {
    const statusMap = {
      'NS': { class: 'bg-green-500', text: 'Not Started' },
      'LIVE': { class: 'bg-red-500 animate-pulse', text: 'LIVE' },
      '1H': { class: 'bg-red-500 animate-pulse', text: '1st Half' },
      '2H': { class: 'bg-red-500 animate-pulse', text: '2nd Half' },
      'HT': { class: 'bg-orange-500', text: 'Half Time' },
      'FT': { class: 'bg-gray-600', text: 'Full Time' },
      'ET': { class: 'bg-red-500 animate-pulse', text: 'Extra Time' },
      'P': { class: 'bg-red-500 animate-pulse', text: 'Penalties' }
    };
    const s = statusMap[status] || { class: 'bg-gray-500', text: status };
    return <span className={`${s.class} text-white px-2.5 py-1 rounded text-xs font-bold`}>{s.text}</span>;
  };

  return (
    <div style={{
      fontFamily: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      minHeight: '100vh',
      color: '#333'
    }}>
      {/* Header */}
      <div style={{
        background: 'rgba(255, 255, 255, 0.95)',
        padding: '20px',
        boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
        position: 'sticky',
        top: 0,
        zIndex: 1000
      }}>
        <h1 style={{
          textAlign: 'center',
          color: '#667eea',
          fontSize: '2rem',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          gap: '10px',
          margin: 0
        }}>
          ‚öΩ Live Football Predictions
          <span style={{
            display: 'inline-block',
            width: '12px',
            height: '12px',
            background: '#ff4444',
            borderRadius: '50%',
            animation: 'pulse 2s infinite'
          }}></span>
        </h1>
        
        <div style={{
          textAlign: 'center',
          color: '#764ba2',
          fontSize: '1.2rem',
          fontWeight: 'bold',
          marginTop: '10px'
        }}>
          üáµüá∞ {pktTime || 'Loading...'}
        </div>

        <div style={{
          display: 'flex',
          justifyContent: 'center',
          gap: '30px',
          marginTop: '15px',
          flexWrap: 'wrap'
        }}>
          <div style={{
            background: 'linear-gradient(135deg, #667eea, #764ba2)',
            color: 'white',
            padding: '10px 20px',
            borderRadius: '8px',
            fontSize: '0.9rem',
            fontWeight: 'bold'
          }}>
            üìä Matches: {matches.length}
          </div>
          <div style={{
            background: 'linear-gradient(135deg, #667eea, #764ba2)',
            color: 'white',
            padding: '10px 20px',
            borderRadius: '8px',
            fontSize: '0.9rem',
            fontWeight: 'bold'
          }}>
            üéØ Predictions: {predictions.length}
          </div>
          <div style={{
            background: 'linear-gradient(135deg, #667eea, #764ba2)',
            color: 'white',
            padding: '10px 20px',
            borderRadius: '8px',
            fontSize: '0.9rem',
            fontWeight: 'bold'
          }}>
            üîÑ Last Update: {lastUpdate}
          </div>
        </div>
      </div>

      {/* Container */}
      <div style={{
        display: 'grid',
        gridTemplateColumns: '1fr 1fr',
        gap: '20px',
        padding: '20px',
        maxWidth: '1800px',
        margin: '0 auto'
      }}>
        {/* LEFT: Matches */}
        <div style={{
          background: 'white',
          borderRadius: '12px',
          padding: '20px',
          boxShadow: '0 8px 16px rgba(0,0,0,0.1)',
          maxHeight: 'calc(100vh - 220px)',
          overflowY: 'auto'
        }}>
          <h2 style={{
            color: '#667eea',
            marginBottom: '20px',
            fontSize: '1.5rem',
            borderBottom: '3px solid #667eea',
            paddingBottom: '10px',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between'
          }}>
            üìÖ Today's Matches
            <span style={{
              background: '#ff4444',
              color: 'white',
              padding: '5px 12px',
              borderRadius: '20px',
              fontSize: '0.8rem'
            }}>
              {matches.length}
            </span>
          </h2>

          {loading ? (
            <div style={{ textAlign: 'center', padding: '40px', color: '#667eea' }}>
              <div style={{
                border: '4px solid #f3f3f3',
                borderTop: '4px solid #667eea',
                borderRadius: '50%',
                width: '50px',
                height: '50px',
                animation: 'spin 1s linear infinite',
                margin: '20px auto'
              }}></div>
              Loading matches...
            </div>
          ) : matches.length === 0 ? (
            <div style={{ textAlign: 'center', padding: '40px', color: '#999' }}>
              üì≠ No matches scheduled for today
            </div>
          ) : (
            matches.map((match, idx) => (
              <div key={idx} style={{
                background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
                borderRadius: '10px',
                padding: '15px',
                marginBottom: '15px',
                borderLeft: '5px solid #667eea',
                transition: 'all 0.3s'
              }}>
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: '10px'
                }}>
                  <span style={{
                    background: '#667eea',
                    color: 'white',
                    padding: '5px 10px',
                    borderRadius: '5px',
                    fontSize: '0.75rem',
                    fontWeight: 'bold'
                  }}>
                    {match.league_name || match.league || 'Unknown'}
                  </span>
                  {getStatusBadge(match.status)}
                </div>

                <div style={{
                  color: '#666',
                  fontSize: '0.9rem',
                  marginTop: '5px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '5px'
                }}>
                  üïê <span style={{
                    background: '#fff3cd',
                    color: '#856404',
                    padding: '3px 8px',
                    borderRadius: '4px',
                    fontWeight: 'bold',
                    fontSize: '0.85rem'
                  }}>
                    {match.match_time_pkt || 'Time TBA'}
                  </span>
                </div>

                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  margin: '15px 0',
                  fontSize: '1.1rem',
                  fontWeight: 'bold'
                }}>
                  <div style={{ flex: 1, textAlign: 'center' }}>{match.home_team}</div>
                  <div style={{ color: '#667eea', fontWeight: 'bold', padding: '0 15px' }}>VS</div>
                  <div style={{ flex: 1, textAlign: 'center' }}>{match.away_team}</div>
                </div>

                {match.status !== 'NS' && (
                  <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    gap: '10px',
                    fontSize: '1.8rem',
                    fontWeight: 'bold',
                    color: '#ff4444',
                    margin: '10px 0'
                  }}>
                    <span>{match.home_score || 0}</span>
                    <span>-</span>
                    <span>{match.away_score || 0}</span>
                  </div>
                )}

                {match.venue && (
                  <div style={{
                    textAlign: 'center',
                    color: '#666',
                    fontSize: '0.8rem',
                    marginTop: '5px'
                  }}>
                    üìç {match.venue}
                  </div>
                )}
              </div>
            ))
          )}
        </div>

        {/* RIGHT: Predictions */}
        <div style={{
          background: 'white',
          borderRadius: '12px',
          padding: '20px',
          boxShadow: '0 8px 16px rgba(0,0,0,0.1)',
          maxHeight: 'calc(100vh - 220px)',
          overflowY: 'auto'
        }}>
          <h2 style={{
            color: '#667eea',
            marginBottom: '20px',
            fontSize: '1.5rem',
            borderBottom: '3px solid #667eea',
            paddingBottom: '10px',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between'
          }}>
            üéØ AI Predictions
            <span style={{
              background: '#ff4444',
              color: 'white',
              padding: '5px 12px',
              borderRadius: '20px',
              fontSize: '0.8rem'
            }}>
              {predictions.length}
            </span>
          </h2>

          {loading ? (
            <div style={{ textAlign: 'center', padding: '40px', color: '#667eea' }}>
              <div style={{
                border: '4px solid #f3f3f3',
                borderTop: '4px solid #667eea',
                borderRadius: '50%',
                width: '50px',
                height: '50px',
                animation: 'spin 1s linear infinite',
                margin: '20px auto'
              }}></div>
              Loading predictions...
            </div>
          ) : predictions.length === 0 ? (
            <div style={{ textAlign: 'center', padding: '40px', color: '#999' }}>
              ü§ñ Predictions loading...
            </div>
          ) : (
            predictions.map((pred, idx) => (
              <div key={idx} style={{
                background: 'white',
                borderRadius: '10px',
                padding: '15px',
                marginBottom: '15px',
                borderLeft: '5px solid #764ba2',
                boxShadow: '0 4px 8px rgba(0,0,0,0.1)',
                transition: 'all 0.3s'
              }}>
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: '10px'
                }}>
                  <span style={{
                    background: '#667eea',
                    color: 'white',
                    padding: '5px 10px',
                    borderRadius: '5px',
                    fontSize: '0.75rem',
                    fontWeight: 'bold'
                  }}>
                    {pred.league || 'Unknown'}
                  </span>
                  <span style={{
                    background: 'linear-gradient(135deg, #ffd89b, #19547b)',
                    color: 'white',
                    padding: '5px 12px',
                    borderRadius: '5px',
                    fontSize: '0.8rem',
                    fontWeight: 'bold'
                  }}>
                    ‚≠ê {pred.confidence_score || 0}% Confidence
                  </span>
                </div>

                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  margin: '15px 0',
                  fontSize: '1.1rem',
                  fontWeight: 'bold'
                }}>
                  <div style={{ flex: 1, textAlign: 'center' }}>{pred.home_team}</div>
                  <div style={{ color: '#667eea', fontWeight: 'bold', padding: '0 15px' }}>VS</div>
                  <div style={{ flex: 1, textAlign: 'center' }}>{pred.away_team}</div>
                </div>

                <div style={{
                  color: '#666',
                  fontSize: '0.9rem',
                  marginTop: '5px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '5px',
                  justifyContent: 'center'
                }}>
                  üïê <span style={{
                    background: '#fff3cd',
                    color: '#856404',
                    padding: '3px 8px',
                    borderRadius: '4px',
                    fontWeight: 'bold',
                    fontSize: '0.85rem'
                  }}>
                    {pred.match_time_pkt || 'Time TBA'}
                  </span>
                </div>

                {/* Winner Probabilities */}
                <div style={{
                  display: 'flex',
                  gap: '10px',
                  margin: '15px 0'
                }}>
                  <div style={{ flex: 1, textAlign: 'center' }}>
                    <div style={{ fontSize: '0.8rem', color: '#666', marginBottom: '5px' }}>Home Win</div>
                    <div style={{
                      background: 'linear-gradient(135deg, #56ab2f, #a8e063)',
                      color: 'white',
                      padding: '12px',
                      borderRadius: '8px',
                      fontWeight: 'bold',
                      fontSize: '1.3rem'
                    }}>
                      {pred.winner_prob?.home || 0}%
                    </div>
                  </div>
                  <div style={{ flex: 1, textAlign: 'center' }}>
                    <div style={{ fontSize: '0.8rem', color: '#666', marginBottom: '5px' }}>Draw</div>
                    <div style={{
                      background: 'linear-gradient(135deg, #ffd89b, #19547b)',
                      color: 'white',
                      padding: '12px',
                      borderRadius: '8px',
                      fontWeight: 'bold',
                      fontSize: '1.3rem'
                    }}>
                      {pred.winner_prob?.draw || 0}%
                    </div>
                  </div>
                  <div style={{ flex: 1, textAlign: 'center' }}>
                    <div style={{ fontSize: '0.8rem', color: '#666', marginBottom: '5px' }}>Away Win</div>
                    <div style={{
                      background: 'linear-gradient(135deg, #f857a6, #ff5858)',
                      color: 'white',
                      padding: '12px',
                      borderRadius: '8px',
                      fontWeight: 'bold',
                      fontSize: '1.3rem'
                    }}>
                      {pred.winner_prob?.away || 0}%
                    </div>
                  </div>
                </div>

                {/* xG Display */}
                {pred.xG && (
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-around',
                    background: '#f5f7fa',
                    padding: '12px',
                    borderRadius: '8px',
                    margin: '12px 0'
                  }}>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ color: '#666', fontSize: '0.75rem', marginBottom: '5px' }}>Home xG</div>
                      <div style={{ fontWeight: 'bold', color: '#764ba2', fontSize: '1.2rem' }}>
                        {pred.xG.home || 0}
                      </div>
                    </div>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ color: '#666', fontSize: '0.75rem', marginBottom: '5px' }}>Total xG</div>
                      <div style={{ fontWeight: 'bold', color: '#764ba2', fontSize: '1.2rem' }}>
                        {pred.xG.total || 0}
                      </div>
                    </div>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ color: '#666', fontSize: '0.75rem', marginBottom: '5px' }}>Away xG</div>
                      <div style={{ fontWeight: 'bold', color: '#764ba2', fontSize: '1.2rem' }}>
                        {pred.xG.away || 0}
                      </div>
                    </div>
                  </div>
                )}

                {/* Markets */}
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(100px, 1fr))',
                  gap: '10px',
                  marginTop: '15px'
                }}>
                  <div style={{
                    background: '#f5f7fa',
                    padding: '10px',
                    borderRadius: '5px',
                    textAlign: 'center',
                    fontSize: '0.85rem'
                  }}>
                    <div style={{ color: '#666', marginBottom: '5px', fontSize: '0.75rem' }}>BTTS</div>
                    <div style={{ fontWeight: 'bold', color: '#667eea', fontSize: '1rem' }}>
                      {pred.btts_prob || 0}%
                    </div>
                  </div>
                  <div style={{
                    background: '#f5f7fa',
                    padding: '10px',
                    borderRadius: '5px',
                    textAlign: 'center',
                    fontSize: '0.85rem'
                  }}>
                    <div style={{ color: '#666', marginBottom: '5px', fontSize: '0.75rem' }}>Over 2.5</div>
                    <div style={{ fontWeight: 'bold', color: '#667eea', fontSize: '1rem' }}>
                      {pred.over_under?.['2.5'] || 0}%
                    </div>
                  </div>
                  <div style={{
                    background: '#f5f7fa',
                    padding: '10px',
                    borderRadius: '5px',
                    textAlign: 'center',
                    fontSize: '0.85rem'
                  }}>
                    <div style={{ color: '#666', marginBottom: '5px', fontSize: '0.75rem' }}>Over 3.5</div>
                    <div style={{ fontWeight: 'bold', color: '#667eea', fontSize: '1rem' }}>
                      {pred.over_under?.['3.5'] || 0}%
                    </div>
                  </div>
                  <div style={{
                    background: '#f5f7fa',
                    padding: '10px',
                    borderRadius: '5px',
                    textAlign: 'center',
                    fontSize: '0.85rem'
                  }}>
                    <div style={{ color: '#666', marginBottom: '5px', fontSize: '0.75rem' }}>Last 10 min</div>
                    <div style={{ fontWeight: 'bold', color: '#667eea', fontSize: '1rem' }}>
                      {pred.last10_prob || 0}%
                    </div>
                  </div>
                </div>

                {/* Strong Markets */}
                {pred.strong_markets && pred.strong_markets.length > 0 && (
                  <div style={{
                    background: 'linear-gradient(135deg, #56ab2f, #a8e063)',
                    color: 'white',
                    padding: '12px',
                    borderRadius: '8px',
                    marginTop: '12px'
                  }}>
                    <h4 style={{ marginBottom: '8px', fontSize: '0.9rem', margin: '0 0 8px 0' }}>
                      üî• High Confidence (‚â•85%)
                    </h4>
                    {pred.strong_markets.map((m, i) => (
                      <div key={i} style={{
                        background: 'rgba(255,255,255,0.2)',
                        padding: '6px 10px',
                        borderRadius: '5px',
                        margin: '5px 0',
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: '0.85rem'
                      }}>
                        <span>{m.market}</span>
                        <span><strong>{m.prob}%</strong></span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            ))
          )}
        </div>
      </div>

      <style>{`
        @keyframes pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.5; transform: scale(1.1); }
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        ::-webkit-scrollbar {
          width: 8px;
        }
        ::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
          background: #667eea;
          border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
          background: #764ba2;
        }
        @media (max-width: 1024px) {
          .container {
            grid-template-columns: 1fr !important;
          }
        }
      `}</style>
    </div>
  );
}
