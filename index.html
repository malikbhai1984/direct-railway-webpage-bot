import React, { useState, useEffect } from 'react';
import { Trophy, Clock, TrendingUp, Target, Bell, Activity, Wifi, WifiOff } from 'lucide-react';

export default function FootballPredictionSystem() {
  const [activeTab, setActiveTab] = useState('matches');
  const [matches, setMatches] = useState([]);
  const [predictions, setPredictions] = useState([]);
  const [newPredictions, setNewPredictions] = useState(0);
  const [lastUpdate, setLastUpdate] = useState('');
  const [loading, setLoading] = useState(true);
  const [isOnline, setIsOnline] = useState(true);

  // Mock data for demonstration
  useEffect(() => {
    const mockMatches = [
      {
        id: '536940',
        league_name: 'Serie A',
        home_team: 'Bologna FC 1909',
        away_team: 'US Cremonese',
        home_score: null,
        away_score: null,
        status: 'NS',
        match_time_pkt: '02 Dec 2025, 12:45 AM',
        venue: 'Stadio Renato Dall\'Ara',
        home_logo: 'https://media.api-sports.io/football/teams/500.png',
        away_logo: 'https://media.api-sports.io/football/teams/520.png'
      },
      {
        id: '536941',
        league_name: 'Premier League',
        home_team: 'Manchester United',
        away_team: 'Chelsea',
        home_score: 2,
        away_score: 1,
        status: 'LIVE',
        match_time_pkt: '01 Dec 2025, 10:30 PM',
        venue: 'Old Trafford',
        home_logo: 'https://media.api-sports.io/football/teams/33.png',
        away_logo: 'https://media.api-sports.io/football/teams/49.png'
      }
    ];

    const mockPredictions = [
      {
        id: '1',
        home_team: 'Bologna FC 1909',
        away_team: 'US Cremonese',
        league: 'Serie A',
        confidence_score: 78,
        winner_prob: { home: 45, draw: 30, away: 25 },
        xG: { home: 1.8, away: 1.2 },
        btts_prob: 62,
        strong_markets: [
          { market: 'Over 2.5', probability: 68 },
          { market: 'Home Win', probability: 45 }
        ]
      },
      {
        id: '2',
        home_team: 'Manchester United',
        away_team: 'Chelsea',
        league: 'Premier League',
        confidence_score: 85,
        winner_prob: { home: 52, draw: 25, away: 23 },
        xG: { home: 2.1, away: 1.5 },
        btts_prob: 71,
        strong_markets: [
          { market: 'Over 2.5', probability: 75 },
          { market: 'BTTS', probability: 71 }
        ]
      }
    ];

    setMatches(mockMatches);
    setPredictions(mockPredictions);
    setLastUpdate(new Date().toLocaleTimeString('en-PK', { 
      hour: '2-digit', 
      minute: '2-digit', 
      hour12: true 
    }));
    setLoading(false);
  }, []);

  // Auto-refresh simulation
  useEffect(() => {
    const interval = setInterval(() => {
      setLastUpdate(new Date().toLocaleTimeString('en-PK', { 
        hour: '2-digit', 
        minute: '2-digit', 
        hour12: true 
      }));
    }, 60000);
    return () => clearInterval(interval);
  }, []);

  const getStatusBadge = (status) => {
    const statusMap = {
      'NS': { bg: 'bg-gray-500', text: 'Not Started' },
      'LIVE': { bg: 'bg-red-500 animate-pulse', text: 'LIVE' },
      '1H': { bg: 'bg-green-500 animate-pulse', text: '1st Half' },
      '2H': { bg: 'bg-green-500 animate-pulse', text: '2nd Half' },
      'HT': { bg: 'bg-yellow-500', text: 'Half Time' },
      'FT': { bg: 'bg-blue-500', text: 'Full Time' }
    };
    const badge = statusMap[status] || { bg: 'bg-gray-500', text: status };
    return (
      <span className={`${badge.bg} text-white text-xs px-3 py-1 rounded-full font-semibold`}>
        {badge.text}
      </span>
    );
  };

  const MatchCard = ({ match }) => (
    <div className="bg-white rounded-lg shadow-md p-4 mb-4 hover:shadow-lg transition-shadow">
      <div className="flex justify-between items-center mb-3">
        <span className="text-sm font-semibold text-blue-600">{match.league_name}</span>
        {getStatusBadge(match.status)}
      </div>
      
      <div className="space-y-3">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2 flex-1">
            {match.home_logo && (
              <img src={match.home_logo} alt={match.home_team} className="w-8 h-8" />
            )}
            <span className="font-medium">{match.home_team}</span>
          </div>
          <span className="text-2xl font-bold mx-4">{match.home_score ?? '-'}</span>
        </div>
        
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2 flex-1">
            {match.away_logo && (
              <img src={match.away_logo} alt={match.away_team} className="w-8 h-8" />
            )}
            <span className="font-medium">{match.away_team}</span>
          </div>
          <span className="text-2xl font-bold mx-4">{match.away_score ?? '-'}</span>
        </div>
      </div>

      <div className="mt-4 pt-3 border-t flex justify-between text-xs text-gray-600">
        <span>üïê {match.match_time_pkt}</span>
        <span>üìç {match.venue}</span>
      </div>
    </div>
  );

  const PredictionCard = ({ pred }) => {
    const highestProb = Math.max(
      pred.winner_prob.home,
      pred.winner_prob.draw,
      pred.winner_prob.away
    );
    const winnerLabel = 
      pred.winner_prob.home === highestProb ? 'Home Win' :
      pred.winner_prob.away === highestProb ? 'Away Win' : 'Draw';

    return (
      <div className="bg-white rounded-lg shadow-md p-5 mb-4 hover:shadow-lg transition-shadow">
        <div className="text-center mb-4">
          <div className="font-bold text-lg">{pred.home_team}</div>
          <div className="text-gray-500 text-sm my-1">vs</div>
          <div className="font-bold text-lg">{pred.away_team}</div>
        </div>

        <div className="flex items-center justify-center gap-2 mb-3">
          <Target className="w-4 h-4 text-green-600" />
          <span className="text-sm font-semibold">Confidence: {pred.confidence_score}%</span>
        </div>

        <div className="text-xs text-gray-600 text-center mb-4">{pred.league}</div>

        {/* Winner Probabilities */}
        <div className="mb-4">
          <div className="text-sm font-semibold mb-2">üéØ Match Result</div>
          <div className="space-y-2">
            <div className="flex items-center justify-between">
              <span className="text-xs">Home</span>
              <div className="flex-1 mx-2 bg-gray-200 rounded-full h-2">
                <div 
                  className="bg-green-500 h-2 rounded-full transition-all" 
                  style={{ width: `${pred.winner_prob.home}%` }}
                />
              </div>
              <span className="text-xs font-bold">{pred.winner_prob.home}%</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-xs">Draw</span>
              <div className="flex-1 mx-2 bg-gray-200 rounded-full h-2">
                <div 
                  className="bg-yellow-500 h-2 rounded-full transition-all" 
                  style={{ width: `${pred.winner_prob.draw}%` }}
                />
              </div>
              <span className="text-xs font-bold">{pred.winner_prob.draw}%</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-xs">Away</span>
              <div className="flex-1 mx-2 bg-gray-200 rounded-full h-2">
                <div 
                  className="bg-blue-500 h-2 rounded-full transition-all" 
                  style={{ width: `${pred.winner_prob.away}%` }}
                />
              </div>
              <span className="text-xs font-bold">{pred.winner_prob.away}%</span>
            </div>
          </div>
        </div>

        {/* Expected Goals */}
        <div className="bg-gray-50 rounded p-3 mb-3">
          <div className="text-sm font-semibold mb-2">‚öΩ Expected Goals</div>
          <div className="text-center text-2xl font-bold">
            {pred.xG.home.toFixed(1)} - {pred.xG.away.toFixed(1)}
          </div>
          <div className="text-center text-xs text-gray-600 mt-2">
            BTTS: {pred.btts_prob}%
          </div>
        </div>

        {/* Strong Markets */}
        {pred.strong_markets && pred.strong_markets.length > 0 && (
          <div>
            <div className="text-sm font-semibold mb-2">üíé Strong Markets</div>
            <div className="flex flex-wrap gap-2">
              {pred.strong_markets.map((market, idx) => (
                <span 
                  key={idx} 
                  className="bg-purple-100 text-purple-800 text-xs px-3 py-1 rounded-full"
                >
                  {market.market} ({market.probability}%)
                </span>
              ))}
            </div>
          </div>
        )}
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50">
      {/* Header */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 shadow-lg">
        <div className="max-w-7xl mx-auto">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-3">
              <Trophy className="w-8 h-8" />
              <h1 className="text-3xl font-bold">Football Prediction System</h1>
            </div>
            <div className="flex items-center gap-3">
              {isOnline ? (
                <Wifi className="w-5 h-5 text-green-300" />
              ) : (
                <WifiOff className="w-5 h-5 text-red-300" />
              )}
              {newPredictions > 0 && (
                <div className="bg-red-500 text-white px-3 py-1 rounded-full text-sm flex items-center gap-1 animate-bounce">
                  <Bell className="w-4 h-4" />
                  {newPredictions} new
                </div>
              )}
            </div>
          </div>
          
          <div className="flex items-center gap-6 text-sm">
            <div className="flex items-center gap-2">
              <Clock className="w-4 h-4" />
              <span>Last Update: {lastUpdate}</span>
            </div>
            <div className="flex items-center gap-2">
              <Activity className="w-4 h-4" />
              <span>Auto-refresh: 5 min</span>
            </div>
          </div>
        </div>
      </div>

      {/* Tabs */}
      <div className="max-w-7xl mx-auto px-6 py-4">
        <div className="flex gap-4 mb-6">
          <button
            onClick={() => setActiveTab('matches')}
            className={`px-6 py-3 rounded-lg font-semibold transition-all ${
              activeTab === 'matches'
                ? 'bg-blue-600 text-white shadow-lg'
                : 'bg-white text-gray-700 hover:bg-gray-100'
            }`}
          >
            üìä Live Matches ({matches.length})
          </button>
          <button
            onClick={() => setActiveTab('predictions')}
            className={`px-6 py-3 rounded-lg font-semibold transition-all ${
              activeTab === 'predictions'
                ? 'bg-purple-600 text-white shadow-lg'
                : 'bg-white text-gray-700 hover:bg-gray-100'
            }`}
          >
            üéØ Predictions ({predictions.length})
          </button>
        </div>

        {/* Content */}
        {loading ? (
          <div className="text-center py-20">
            <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"></div>
            <p className="mt-4 text-gray-600">Loading data...</p>
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {activeTab === 'matches' ? (
              matches.length > 0 ? (
                matches.map((match) => <MatchCard key={match.id} match={match} />)
              ) : (
                <div className="col-span-full text-center py-20 text-gray-500">
                  No matches available
                </div>
              )
            ) : (
              predictions.length > 0 ? (
                predictions.map((pred) => <PredictionCard key={pred.id} pred={pred} />)
              ) : (
                <div className="col-span-full text-center py-20 text-gray-500">
                  No predictions available
                </div>
              )
            )}
          </div>
        )}
      </div>
    </div>
  );
}
