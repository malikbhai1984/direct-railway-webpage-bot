<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Live Predictions</title>
<style>
body { background:#111; color:#fff; font-family:Arial; padding:20px; }
.left, .right { padding:15px; background:#1a1a1a; border-radius:10px; }
.layout { display:flex; gap:20px; }
h2 { color:#00ff80; }
.predCard { background:#222; padding:10px; margin-bottom:10px; border-radius:8px; }
.strong { background:#053; }
.small { color:#bbb; font-size:12px; }
</style>
</head>

<body>

<h1>âš½ Live Auto Predictions</h1>

<div class="layout">
  <div class="left" style="width:35%">
    <h2>Today Matches</h2>
    <div id="matchList">Loading...</div>
  </div>

  <div class="right" style="width:65%">
    <h2>Live Predictions</h2>
    <div id="predList">Waiting...</div>
  </div>
</div>

<script>
async function loadToday(){
  try {
    const r = await fetch("/today");
    const j = await r.json();

    const box = document.getElementById("matchList");
    if(!j.success) return box.innerHTML="Error loading";

    let html="";
    j.data.forEach(m=>{
      html += `<div><b>${m.home} vs ${m.away}</b><br>
      <span class='small'>${m.league} â€¢ ${m.kickoff} PKT â€¢ ${m.status}</span></div><hr>`;
    });

    box.innerHTML = html;

  } catch(e){ console.log(e); }
}

loadToday();
setInterval(loadToday, 7*60*1000);

// ========== SSE ==========
const box = document.getElementById("predList");
const sse = new EventSource("/events");

sse.onmessage = e => {
  try {
    const data = JSON.parse(e.data);
    if(data.welcome){
      box.innerHTML = "<div class='small'>ðŸ”” AUTO PREDICTION ACTIVE</div>";
      return;
    }

    let html = `<div class='small'>Updated: ${new Date(data.ts).toLocaleString()}</div>`;
    data.matches.forEach(m=>{
      const p = m.prediction;
      const strong = (p.bttsProb>=85 || p.winnerProb.home>=85 || p.winnerProb.away>=85);
      html += `<div class="predCard ${strong?'strong':''}">
        <b>${m.teams}</b> <span class='small'>(${m.matchDate})</span><br>
        Winner â†’ H:${p.winnerProb.home}% D:${p.winnerProb.draw}% A:${p.winnerProb.away}%<br>
        BTTS â†’ ${p.bttsProb}%<br>
        Last10 â†’ ${p.last10Prob}%<br>
        <span class='small'>Exp: H ${p.expectedGoals.home} â€¢ A ${p.expectedGoals.away}</span>
      </div>`;
    });

    box.innerHTML = html;

  } catch(err){ console.log("SSE error", err); }
};
</script>

</body>
</html>
