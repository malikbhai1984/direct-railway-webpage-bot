<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Football Auto Prediction</title>

<style>
  body {
    background: #111;
    color: #fff;
    font-family: Arial;
    text-align: center;
    padding: 20px;
  }

  h1 {
    color: #00ff90;
    margin-bottom: 20px;
  }

  #predictionBox {
    background: #1b1b1b;
    border: 2px solid #00ff90;
    border-radius: 12px;
    padding: 18px;
    margin: 0 auto;
    font-size: 18px;
    width: 95%;
    max-width: 900px;
    min-height: 100px;
    text-align: left;
  }

  .matchCard {
    padding: 10px;
    margin-top: 10px;
    background: #222;
    border-radius: 8px;
  }

  .strong {
    background: #073;
  }
</style>

</head>
<body>

<h1>‚öΩ Live Football Predictions</h1>

<!-- ONLY ONE PREDICTION BOX -->
<div id="predictionBox">Connecting to prediction server...</div>

<script>
  console.log("üì° Connecting to SSE event stream...");
  const sse = new EventSource('/events');

  sse.onopen = () => {
    document.getElementById("predictionBox").innerHTML = "üîÑ Loading live predictions...";
  };

  sse.onerror = () => {
    document.getElementById("predictionBox").innerHTML =
      "<span style='color:#f33'>‚ùå Connection Lost ‚Äî Backend Not Responding</span>";
  };

  sse.onmessage = (e) => {
    try {
      const data = JSON.parse(e.data);
      const box = document.getElementById("predictionBox");

      let html = `
        <div><b>Updated:</b> ${new Date(data.ts).toLocaleString()}</div>
        <div><b>Total Matches:</b> ${data.matchesCount}</div>
        <hr style='border-color:#00ff90'>
      `;

      if (data.matches.length === 0) {
        html += `<div>No matches found for today.</div>`;
      }

      data.matches.forEach(m => {
        const isStrong = (m.confidence >= 85 || (m.strongMarkets && m.strongMarkets.length));
        html += `
          <div class="matchCard ${isStrong ? 'strong' : ''}">
            <b>${m.home} vs ${m.away}</b>  
            <br>Kickoff: ${m.kickoffLocal}
            <br>Confidence: <b>${m.confidence}%</b>
            <br>BTTS Chance: ${m.bttsProb}%
            <br>Last 10 min Goal Chance: ${m.last10Prob}%
        `;

        if (m.strongMarkets && m.strongMarkets.length > 0) {
          html += `
            <div style="margin-top:6px;color:#0f0"><b>Strong Markets:</b><br>
              ${m.strongMarkets.map(s => s.market + " (" + s.prob + "%)").join(", ")}
            </div>
          `;
        }

        html += `</div>`;
      });

      box.innerHTML = html;

    } catch (err) {
      console.error("Front-end SSE Parse Error:", err);
      document.getElementById("predictionBox").innerHTML =
        "<span style='color:#f33'>‚ùå Front-End Error Parsing Prediction Data</span>";
    }
  };
</script>

</body>
</html>
