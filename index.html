



<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš½ Live Auto Predictions (PKT)</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
  header { background: #222; color: #fff; padding: 15px; text-align: center; font-size: 1.2em; }
  .container { display: flex; flex-wrap: wrap; padding: 10px; }
  .box { flex: 1; min-width: 300px; background: #fff; margin: 5px; padding: 10px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
  h2 { margin-top: 0; font-size: 1em; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
  .match, .prediction { margin-bottom: 10px; padding: 5px; border-bottom: 1px solid #eee; }
  .strong-markets { color: green; font-weight: bold; }
</style>
</head>
<body>

<header>
âš½ Live Auto Predictions (PKT) | Auto updates every 5 minutes âœ…
</header>

<div class="container">
  <div class="box">
    <h2>ðŸ“… Today Matches (PKT)</h2>
    <div id="todayMatches">Loading...</div>
  </div>
  <div class="box">
    <h2>ðŸ”® Live Predictions</h2>
    <div id="livePredictions">Waiting for updates...</div>
  </div>
</div>

<script>
async function loadTodayMatches() {
  try {
    const res = await fetch("/today-matches");
    const matches = await res.json();
    const container = document.getElementById("todayMatches");
    if (!matches.length) {
      container.innerHTML = "No live matches today.";
      return;
    }
    container.innerHTML = matches.map(m => {
      const home = m.teams.home.name || "Unknown";
      const away = m.teams.away.name || "Unknown";
      const status = m.status ? m.status.short || m.status.long || "" : "";
      return `<div class="match">${home} vs ${away} (${status})</div>`;
    }).join("");
  } catch (err) {
    console.error(err);
    document.getElementById("todayMatches").innerHTML = "Failed to load matches.";
  }
}

// Initial load
loadTodayMatches();
// Refresh every 5 minutes
setInterval(loadTodayMatches, 5 * 60 * 1000);

// ---------------- SSE Live Predictions ----------------
const evtSource = new EventSource("/events");
evtSource.onmessage = e => {
  try {
    const data = JSON.parse(e.data);
    const container = document.getElementById("livePredictions");
    if (!data.matches.length) {
      container.innerHTML = "No predictions available yet.";
      return;
    }

    container.innerHTML = data.matches.map(m => {
      const teams = m.teams || "Unknown vs Unknown";
      const winner = m.winnerProb || { home: 0, draw: 0, away: 0 };
      const btts = m.bttsProb || 0;
      const last10 = m.last10Prob || 0;
      const xG = m.xG || { home: 0, away: 0, total: 0 };
      const strongMarkets = (m.strongMarkets && m.strongMarkets.length) ? 
        m.strongMarkets.map(s => `${s.market} (${s.prob}%)`).join(", ") : "None";

      return `<div class="prediction">
        <strong>${teams}</strong><br>
        Winner: H:${winner.home}% | D:${winner.draw}% | A:${winner.away}%<br>
        BTTS: ${btts}% | Last 10 min: ${last10}%<br>
        xG: H:${xG.home}, A:${xG.away}, Total:${xG.total}<br>
        <span class="strong-markets">Strong Markets: ${strongMarkets}</span>
      </div>`;
    }).join("");
  } catch (err) {
    console.error("SSE parse error:", err);
  }
};
</script>

</body>
</html>
